<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PalmTrace H5 Demo</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="bg-blobs" aria-hidden="true"></div>
    <main class="app">
      <header class="hero">
        <div class="brand">
          <span class="logo">PT</span>
          <div>
            <p class="eyebrow">PalmTrace H5</p>
            <h1>手掌掌纹识别与三大主线绘制</h1>
          </div>
        </div>
        <p class="subtitle">
          手机端演示：拍照或导入手掌照片，自动叠加感情线 / 智慧线 / 生命线。
        </p>
      </header>

      <section class="panel input-panel">
        <div class="controls">
          <button class="btn primary" id="btn-camera">拍照</button>
          <button class="btn ghost" id="btn-upload">导入照片</button>
          <button class="btn ghost" id="btn-export" disabled>导出 JSON</button>
          <button class="btn ghost" id="btn-reset">重置</button>
        </div>
        <div class="meta">
          <span class="badge">JPG / PNG</span>
          <span class="badge">本地处理</span>
          <span class="badge">≤ 2s</span>
        </div>
        <input id="file-camera" type="file" accept="image/*" capture="environment" hidden />
        <input id="file-upload" type="file" accept="image/*" hidden />
      </section>

      <section class="panel canvas-panel">
        <div class="canvas-wrap">
          <canvas id="image-canvas"></canvas>
          <canvas id="overlay-canvas"></canvas>
          <div class="edit-toolbar" id="edit-toolbar" aria-label="校正工具栏">
            <button class="tool-btn active" data-tool="drag" type="button">拖动</button>
            <button class="tool-btn" data-tool="add" type="button">新增点</button>
            <button class="tool-btn" data-tool="erase" type="button">橡皮</button>
            <button class="tool-btn" data-tool="undo" type="button">撤销</button>
            <button class="tool-btn" data-tool="reset-line" type="button">重置线</button>
            <button class="tool-btn" data-tool="zoom-in" type="button">放大</button>
            <button class="tool-btn" data-tool="zoom-out" type="button">缩小</button>
            <div class="tool-divider"></div>
            <button class="tool-btn active" data-line="heart" type="button">感情线</button>
            <button class="tool-btn" data-line="head" type="button">智慧线</button>
            <button class="tool-btn" data-line="life" type="button">生命线</button>
          </div>
          <div class="empty-state" id="empty-state">
            <p>请拍摄或导入手掌照片</p>
            <small>建议光线均匀、掌心完整、背景简洁</small>
          </div>
        </div>
        <div class="toggles">
          <label class="toggle">
            <input type="checkbox" id="toggle-heart" checked />
            <span>感情线</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-head" checked />
            <span>智慧线</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-life" checked />
            <span>生命线</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-keypoints" checked />
            <span>掌根/虎口/掌心</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="toggle-edit" />
            <span>手动校正</span>
          </label>
        </div>
      </section>

      <div class="camera-modal" id="camera-modal" aria-hidden="true">
        <div class="camera-card">
          <div class="camera-header">
            <h3>相机拍照</h3>
            <button class="tool-btn" id="btn-camera-close" type="button">关闭</button>
          </div>
          <div class="camera-view">
            <video id="camera-video" autoplay playsinline></video>
            <canvas id="camera-canvas" hidden></canvas>
          </div>
          <div class="camera-actions">
            <button class="btn primary" id="btn-camera-capture" type="button">拍照</button>
            <button class="btn ghost" id="btn-camera-switch" type="button">切换镜头</button>
          </div>
        </div>
      </div>

      <section class="panel results-panel">
        <div class="metrics">
          <div class="metric">
            <span class="label">识别耗时</span>
            <strong id="metric-time">-</strong>
            <span class="badge metric-badge" id="metric-handedness">-</span>
          </div>
          <div class="metric">
            <span class="label">感情线置信度</span>
            <strong id="metric-heart">-</strong>
          </div>
          <div class="metric">
            <span class="label">智慧线置信度</span>
            <strong id="metric-head">-</strong>
          </div>
          <div class="metric">
            <span class="label">生命线置信度</span>
            <strong id="metric-life">-</strong>
          </div>
        </div>
        <div class="alerts" id="alerts"></div>
      </section>

      <section class="panel analysis-panel">
        <div class="analysis-header">
          <div>
            <h2>手相解读</h2>
            <p class="analysis-subtitle">
              基于心线/智慧线/生命线特征生成的非决定论解读，仅供娱乐。
            </p>
          </div>
          <button class="btn primary" id="btn-interpret" disabled>生成解读</button>
        </div>
        <div class="analysis-status" id="analysis-status">尚未生成解读</div>
        <div class="analysis-content" id="analysis-content">
          <div class="analysis-card">
            <h3>整体概览</h3>
            <p id="analysis-overview">-</p>
          </div>
          <div class="analysis-grid">
            <div class="analysis-card">
              <h3>性格倾向</h3>
              <ul id="analysis-traits"></ul>
            </div>
            <div class="analysis-card">
              <h3>优势</h3>
              <ul id="analysis-strengths"></ul>
            </div>
            <div class="analysis-card">
              <h3>挑战</h3>
              <ul id="analysis-challenges"></ul>
            </div>
            <div class="analysis-card">
              <h3>关系风格</h3>
              <ul id="analysis-relationships"></ul>
            </div>
            <div class="analysis-card">
              <h3>事业倾向</h3>
              <ul id="analysis-careers"></ul>
            </div>
            <div class="analysis-card">
              <h3>自我关怀建议</h3>
              <ul id="analysis-selfcare"></ul>
            </div>
            <div class="analysis-card">
              <h3>置信提示</h3>
              <ul id="analysis-confidence"></ul>
            </div>
          </div>
          <div class="analysis-disclaimer" id="analysis-disclaimer">-</div>
        </div>
      </section>

    </main>

    <script>
      window.PALMTRACE_API_URL = "http://127.0.0.1:8000/api/predict";
      window.PALMTRACE_ANALYSIS_URL = "http://127.0.0.1:8000/api/palm/analysis";
    </script>
    <script src="./app.js"></script>
  </body>
</html>
